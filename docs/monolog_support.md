Monolog
-------
Основные сведения можно найти [здесь](https://github.com/Seldaek/monolog/blob/master/README.mdown)

Адаптация для форума
--------------------
### Использование
В основе адаптации лежит класс _\Logs\Logger_, через который и происходит всё общение с _monolog_.

Регистрация нового канала производится командой ``\Logs\Logger::registerChannel(<name>)``. После этого доступ к каналу происходит путём вызова ``\Logs\Logger::<name>()``, которая возвращает экземпляр _\Monolog\Logger_. Соответственно запись с уровнем INFO, например, в канал _Ibf_ будет происходить так ``\Logs\Logger::Ibf()->addInfo('');``

### Конфигурация
Конфигурация для _monolog_ находится в файле ``app/config/logs.php`` и имеет вид:
```php
return [
    //Настройки перехватчика ошибок и исключений PHP. Если настройки отсутствуют перехватчик не включается.
    'error_handler' => [
        //маска уровней сообщений для перехвата. Аналогично значению error_reporting настроек PHP
        'errorReporting' => E_ALL,
        //Имя канала для записи сообщений
        'channel'        => 'PHP',
    ],
    //Настройки каналов. В ключе - имя канала, * - значения по умолчанию для всех. При наличии настроек отдельного
    //канала, они целиком переопределяют настройки по-умолчанию.
    //hint: Каналы здесь не создаются.
    'channels'      => [
        '*'   => [
            'processors' => [ //Перечень процессоров для подключения к каналу
                              '\Monolog\Processor\IntrospectionProcessor',
            ],
        ],
        'PHP' => [
            'processors' => [
                '\Monolog\Processor\IntrospectionProcessor',
                '\Monolog\Processor\WebProcessor',
            ],
        ],
    ],
    //Обработчики логов. Каждый элемент - отдельный обработчик, можно добавлять один и тот-же обработчик несколько раз
    //с разными параметрами (или теми-же если совсем скучно)
    'handlers'      => [
        [
        //  Полное имя класса требуемого обработчика. Обязательно к заполнению
            'class' => '\Monolog\Handler\AbstractHandler',
        //
        //  Список каналов для обработки, при отсутствии обрабатываются все каналы
            'channels' => [ 'PHP' ],
        //
        //  Список каналов, исключаемых из обработки
            'exclude_channels' => [ 'PHP' ],
        //
        //  Список уровней (описанных в \Monolog\Logger), при отсутствии обрабатываются все с учётом возможных
        //  настроек самого обработчика
            'levels' => [ Logger::WARNING ],
        //
        //  Настройки специфичные для обработчика. Сюда включаются:
        //      * Параметры вызова конструктора (поиск осуществляется по именам)
        //      * Публичные свойства
        //      * Параметры вызова сеттеров в виде 'имя сеттера без префикса set' => [ параметры вызова сеттера ],
            'options' => [],
        //
        //  Настройки форматтера. Возможны только ключи class и options, назначение аналогично
            'formatter' => [
                'class' => '\Monolog\Formatter\HtmlFormatter',
                'options' => [
                    'ContentType' => 'text/html',
                ],
            ],
        //
        //  Буферизовать сообщения с отправкой только по окончании работы обработчика (полезно для отправки по почте)
            'buffer_records' => TRUE,
        //
        //  Лимит буфера
            'buffer_limit' => 0,
        //
        //  Фильтр по IP. Вместо любого числа может быть использован символ подстановки '*'
            'ip' => [ 192.168.1.*, 127.0.0.1, *.34.*.* ],
        ],
    ],
];
```

**Внимание**
* Перехватчик ошибок работает независимо от значения настройки PHP *error_reporing*. Он не переопределяет её и не отменяет "сваливание" скрипта в случае перехвата их стандартным обработчиком.
* В ряде случаев PHP использует регистрозависимый поиск методов, поэтому стоит внимательнее относится к именам ключей в параметрах *options*
* При полном отсутствии обработчиков у канала, данные автоматически отсылаются на STDERR. В качестве заглушки используйте _\Monolog\Handler\NullHandler_

## Существующий на данный момент каналы:
* _Ibf_ Общие системные сообщения.
* _PHP_ Обработчик ошибок и исключений PHP (имя может быть изменено через файл конфигурации)
* _PDO_ Низкоуровневая работа с БД (непосредственно запросы, параметры и т.п.)
* _Database_ Пользовательский уровень работы с бд (уведомления о сохранении поста и т.п.)
* _Stats_ Статистические данные
* _Debug_ Канал для тестовых сообщений разработчиков. Теоретически вызовы к нему не должны добавляться в систему контроля версий

## Дополнительные обработчики и процессоры

###Handlers
* *IPFilterHandler* Обёртка для фильтрации сообщений по заданному IP клиента (REMOTE_ADDR). Наиболее полезна в связке с *BrowserConsoleHandler* и аналогичными
* *PMHandler* Обработчик для отсылки сообщений на ЛС указанного пользователя

###Processors
* *MemberProcessor* Добавляет в сообщение данные о пользователе (id и имя) во время сессии которого произошла ошибка.
